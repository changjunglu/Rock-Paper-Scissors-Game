# 功能級 User Story & Use Case v3.0-AC ‧ 2025-07-25

## 版本歷史
| 版本    | 日期       | 內容說明                                           | 負責人 |
|---------|------------|----------------------------------------------------|--------|
| 1.0     | 2025-07-15 | 首版，依FRD產出                                    | AI     |
| 2.0     | 2025-07-16 | 重構更新，基於實際實現                             | AI     |
| 3.0-AC  | 2025-07-25 | 增強版：新增詳細驗收標準(AC)、邊界條件測試、檢核表 | AI     |

---

## 1. 功能級 User Story（Sprint-Ready，標註FRD規則ID，附DoD、Story Point）

### Sprint 1: 核心遊戲機制

#### Story F01-1（BR1, BR2, BR7）
Epic: 核心遊戲體驗
Feature: 遊戲機制
Story: 作為玩家，我希望每局開始時隨機獲得屬性，並可設定變換間隔（3/5/10秒），以便控制遊戲節奏。

Story Points: 5
Priority: Critical
Sprint: Sprint 1

驗收標準 (Acceptance Criteria)

**AC1: 遊戲開始時的屬性分配**
Given 玩家點擊開始新遊戲
And 遊戲進入初始化狀態
When 系統執行屬性分配邏輯
Then 玩家應該隨機獲得剪刀(✂️)、石頭(✊)或布(✋)屬性
And AI對手應該隨機獲得剪刀(✂️)、石頭(✊)或布(✋)屬性
And 兩個角色的屬性應該在遊戲畫面上清楚顯示
And 屬性分配應該完全隨機（每種屬性機率33.33%）

**AC2: RPS變換間隔設定**
Given 玩家在遊戲設定頁面
When 玩家選擇RPS變換間隔選項
Then 系統應該提供3秒、5秒、10秒三個選項
And 預設值應該為5秒
And 選擇的間隔應該立即生效並保存
And 設定值應該在遊戲重啟後仍然保持

**AC3: 倒數計時器功能**
Given 遊戲正在進行中
And RPS變換間隔設定為5秒
When 新一輪屬性分配開始
Then 系統應該顯示倒數計時器從5開始倒數
And 計時器應該每秒遞減顯示: 5→4→3→2→1
And 計時歸零時應該自動觸發新的屬性分配
And 計時器應該具有視覺提示（如顏色變化或動畫）

**AC4: 屬性變換時機處理**
Given 倒數計時器歸零
When 系統執行屬性變換
Then 玩家和AI的屬性應該同時重新隨機分配
And 新屬性應該立即在畫面上更新顯示
And 倒數計時器應該重新開始計時
And 在屬性變換期間，碰撞檢測應該暫時停用0.5秒

**AC5: 間隔設定的邊界驗證**
Given 玩家嘗試修改RPS變換間隔設定
When 玩家選擇無效的間隔值
Then 系統應該只允許選擇預設的3/5/10秒選項
And 如果發生設定錯誤，應該回退到預設值5秒
And 應該顯示錯誤訊息："請選擇有效的時間間隔"

---

#### Story F02-1（BR3, BR6）
Epic: 核心遊戲體驗
Feature: 操作控制
Story: 作為玩家，我希望能用方向鍵移動角色，在800x600遊戲區域內流暢操作。

Story Points: 3
Priority: Critical
Sprint: Sprint 1

驗收標準 (Acceptance Criteria)

**AC1: 基本方向鍵控制**
Given 玩家在遊戲進行狀態
When 玩家按下上方向鍵(↑)
Then 玩家角色應該向上移動
And 移動速度應該保持一致（每幀2-3像素）
And 移動應該流暢無卡頓

When 玩家按下下方向鍵(↓)
Then 玩家角色應該向下移動

When 玩家按下左方向鍵(←)
Then 玩家角色應該向左移動

When 玩家按下右方向鍵(→)
Then 玩家角色應該向右移動

**AC2: 遊戲區域邊界限制**
Given 遊戲區域為800x600像素
And 玩家角色位於邊界附近
When 玩家嘗試移動超出上邊界（y < 0）
Then 角色應該停留在y = 0位置
And 不應該超出遊戲區域顯示

When 玩家嘗試移動超出下邊界（y > 600）
Then 角色應該停留在y = 600位置

When 玩家嘗試移動超出左邊界（x < 0）
Then 角色應該停留在x = 0位置

When 玩家嘗試移動超出右邊界（x > 800）
Then 角色應該停留在x = 800位置

**AC3: 連續按鍵處理**
Given 玩家持續按住方向鍵
When 按鍵持續時間超過100ms
Then 角色應該持續朝該方向移動
And 移動速度應該保持恆定
And 鬆開按鍵後應該立即停止移動

**AC4: 對角線移動**
Given 玩家同時按下兩個方向鍵
When 玩家同時按下上(↑)和右(→)鍵
Then 角色應該朝右上角移動
And 移動速度應該與單方向移動速度相同
And 移動方向應該為對角線45度角

**AC5: 移動效能要求**
Given 遊戲正在運行
When 玩家進行角色移動操作
Then 畫面更新率應該維持60fps
And 按鍵回應延遲應該小於16ms
And CPU使用率應該小於5%

**AC6: 邊界碰撞視覺反饋**
Given 玩家角色碰到遊戲區域邊界
When 角色無法繼續朝該方向移動
Then 可以提供輕微的視覺反饋（如邊界高亮）
And 角色應該能夠沿著邊界移動到其他方向

---

#### Story F03-1（BR4, BR5）
Epic: 核心遊戲體驗
Feature: 碰撞與計分
Story: 作為玩家，我希望碰撞且屬性相剋時能得分，並累積到可設定的勝利分數。

Story Points: 5
Priority: Critical
Sprint: Sprint 1

驗收標準 (Acceptance Criteria)

**AC1: 碰撞檢測機制**
Given 玩家角色位置為(x1, y1)，AI角色位置為(x2, y2)
When 兩角色距離小於等於40像素（角色碰撞範圍）
Then 系統應該檢測到碰撞事件
And 應該觸發屬性相剋判斷邏輯
And 碰撞應該在下一幀立即生效

**AC2: RPS屬性相剋判斷**
Given 發生角色碰撞
When 玩家屬性為石頭(✊) AND AI屬性為剪刀(✂️)
Then 玩家應該得到1分
And 顯示勝利訊息："石頭勝剪刀，玩家得分！"

When 玩家屬性為剪刀(✂️) AND AI屬性為布(✋)
Then 玩家應該得到1分
And 顯示勝利訊息："剪刀勝布，玩家得分！"

When 玩家屬性為布(✋) AND AI屬性為石頭(✊)
Then 玩家應該得到1分
And 顯示勝利訊息："布勝石頭，玩家得分！"

**AC3: AI獲勝情況處理**
Given 發生角色碰撞
When AI屬性為石頭(✊) AND 玩家屬性為剪刀(✂️)
Then AI應該得到1分
And 顯示失敗訊息："石頭勝剪刀，AI得分！"

When AI屬性為剪刀(✂️) AND 玩家屬性為布(✋)
Then AI應該得到1分
And 顯示失敗訊息："剪刀勝布，AI得分！"

When AI屬性為布(✋) AND 玩家屬性為石頭(✊)
Then AI應該得到1分
And 顯示失敗訊息："布勝石頭，AI得分！"

**AC4: 平手情況處理**
Given 發生角色碰撞
When 玩家和AI具有相同屬性
Then 兩邊都不應該得分
And 顯示平手訊息："平手，繼續遊戲！"
And 兩角色應該彈開到安全距離（避免持續碰撞）

**AC5: 勝利分數設定與判定**
Given 玩家在設定頁面選擇勝利分數
When 玩家選擇勝利分數選項
Then 系統應該提供1分、3分、5分、7分四個選項
And 預設值應該為3分
And 設定值應該立即生效並在遊戲中顯示

Given 任一方分數達到設定的勝利分數
When 玩家分數達到勝利分數
Then 遊戲應該結束並顯示勝利畫面
And 顯示最終比分和遊戲時間
And 提供"再玩一局"和"返回設定"選項

**AC6: 碰撞後的角色重置**
Given 碰撞發生且分數已更新
When 相剋判斷完成
Then 兩角色應該重置到隨機的初始位置
And 確保重置位置不會立即觸發新的碰撞
And 兩角色間距離至少100像素

**AC7: 分數顯示更新**
Given 遊戲正在進行中
When 任何一方得分
Then 計分板應該立即更新顯示
And 分數變化應該有視覺動效（如數字彈跳或顏色變化）
And 分數格式：玩家 X : Y AI
And 字體應該清楚易讀

**AC8: 效能要求**
Given 碰撞檢測正在運行
When 遊戲進行中
Then 碰撞檢測應該每幀執行且不影響60fps
And 碰撞計算應該在1ms內完成
And 分數更新UI不應該造成畫面卡頓

### Sprint 2: AI系統

#### Story F04-1（BR9）
Epic: 核心遊戲體驗
Feature: AI策略系統
Story: 作為玩家，我希望能選擇4種不同AI策略，體驗不同難度的挑戰。

Story Points: 8
Priority: High
Sprint: Sprint 2

驗收標準 (Acceptance Criteria)

**AC1: AI策略選擇介面**
Given 玩家在遊戲設定頁面
When 玩家查看AI策略選項
Then 系統應該提供以下4種AI策略選項：
And "積極型AI"：主動追擊玩家
And "謹慎型AI"：保持距離，等待機會
And "隨機型AI"：隨機移動模式
And "進階型AI"：具備預測能力
And 每個選項應該包含策略說明和難度指示
And 預設選項應該為"隨機型AI"

**AC2: 積極型AI行為模式**
Given 選擇積極型AI策略
And 遊戲正在進行中
When AI需要決定下一步移動
Then AI應該計算與玩家的最短路徑
And 優先朝玩家方向移動（直線追擊）
And 移動速度應該與玩家相同
And 在玩家屬性對AI有利時更積極追擊
And 追擊成功率應該達到70%以上

**AC3: 謹慎型AI行為模式**
Given 選擇謹慎型AI策略
When AI偵測到自己屬性劣勢
Then AI應該保持與玩家的安全距離（>100像素）
And 優先移動到遊戲區域邊緣或角落
And 當屬性優勢時才主動接近玩家
And 避免直線移動，採用迂迴路徑
And 逃避成功率應該達到60%以上

**AC4: 隨機型AI行為模式**
Given 選擇隨機型AI策略
When AI執行移動決策
Then AI應該在8個方向中隨機選擇移動方向
And 每2-3秒隨機改變移動方向
And 不考慮玩家位置或屬性關係
And 移動模式應該完全不可預測
And 隨機性應該保證均勻分布

**AC5: 進階型AI行為模式**
Given 選擇進階型AI策略
When AI分析遊戲狀態
Then AI應該記錄玩家過去10步的移動歷史
And 預測玩家下一步可能的位置
And 根據屬性關係選擇最佳策略（追擊或逃避）
And 在屬性變換前預先定位到有利位置
And 整體勝率應該比其他AI高20%

**AC6: AI策略切換功能**
Given 玩家在遊戲進行中
When 玩家按下策略切換快捷鍵（Ctrl+S）
Then 應該彈出策略選擇對話框
And 玩家可以即時切換AI策略
And 新策略應該立即生效
And 不應該影響當前遊戲狀態和分數

**AC7: AI行為性能要求**
Given 任何AI策略正在運行
When AI執行決策計算
Then 每次決策計算應該在5ms內完成
And AI移動更新應該保持60fps
And CPU使用率增加不超過2%
And 記憶體使用增加不超過10MB

**AC8: AI策略驗證測試**
Given 每種AI策略
When 執行100局測試遊戲
Then 積極型AI應該表現出明顯的追擊行為
And 謹慎型AI應該在劣勢時有效逃避
And 隨機型AI的移動模式應該通過隨機性檢驗
And 進階型AI的勝率應該顯著高於隨機型

---

#### Story F05-1（BR10）
Epic: 核心遊戲體驗
Feature: AI智能脫困
Story: 作為玩家，我希望AI不會卡在牆角，能智能脫困繼續遊戲。

Story Points: 5
Priority: High
Sprint: Sprint 2

驗收標準 (Acceptance Criteria)

**AC1: 牆角偵測機制**
Given AI角色位於遊戲區域邊界附近
When AI距離任意兩面相鄰牆壁的距離都小於50像素
Then 系統應該標記AI為"牆角狀態"
And 觸發牆角脫困演算法
And 在debug模式下應該顯示牆角狀態指示

**AC2: 8方向路徑評估**
Given AI處於牆角狀態
When 執行脫困分析
Then AI應該評估8個可能的移動方向：
And 上(↑)、下(↓)、左(←)、右(→)
And 右上(↗)、右下(↘)、左上(↖)、左下(↙)
And 計算每個方向的"自由度分數"（可移動距離）
And 排除會撞牆或越界的方向

**AC3: 最佳脫困路徑選擇**
Given 8方向評估完成
When AI選擇脫困方向
Then 應該優先選擇自由度分數最高的方向
And 如果多個方向分數相同，隨機選擇其中一個
And 選擇的方向應該能讓AI遠離牆角
And 脫困路徑應該朝向遊戲區域中心

**AC4: 緊急移動執行**
Given 脫困方向已選定
When 執行脫困移動
Then AI應該以正常移動速度的1.5倍進行脫困
And 持續朝脫困方向移動直到脫離牆角狀態
And 脫困期間暫時忽略其他AI策略邏輯
And 完成脫困後恢復正常策略行為

**AC5: 連續卡牆預防**
Given AI剛完成一次脫困
When AI可能再次進入同一牆角
Then 系統應該記錄該牆角位置
And 在接下來5秒內避免再次進入該區域
And 如果必須經過該區域，應該加速通過
And 防止AI在同一位置反覆卡牆

**AC6: 不同牆角情況處理**
Given AI可能位於不同類型的牆角
When AI位於遊戲區域四個角落
Then 右上角(800,0)：優先向左下移動
And 右下角(800,600)：優先向左上移動
And 左上角(0,0)：優先向右下移動
And 左下角(0,600)：優先向右上移動

When AI位於邊界中間位置
Then 上邊界：優先向下移動
And 下邊界：優先向上移動
And 左邊界：優先向右移動
And 右邊界：優先向左移動

**AC7: 脫困效果驗證**
Given 牆角脫困機制啟用
When AI遇到牆角情況
Then AI應該在3秒內脫離牆角狀態
And 脫困成功率應該達到95%以上
And 脫困後AI應該能正常執行其策略
And 不應該出現無限循環或卡死情況

**AC8: 多重邊界條件**
Given AI同時面臨多種約束
When AI在牆角且玩家也在附近
Then 脫困邏輯應該優先於策略邏輯
And 脫困完成後再考慮玩家位置
And 不應該因為玩家位置而取消脫困

When AI在牆角且屬性即將變換
Then 脫困移動應該繼續執行
And 屬性變換不應該中斷脫困過程
And 完成脫困後再應用新的屬性策略

### Sprint 3: 用戶介面

#### Story F06-1（BR7）
Epic: 核心遊戲體驗
Feature: 視覺顯示系統
Story: 作為玩家，我希望看到清晰的手勢emoji（✊✋✌️）和玩家資訊。

Story Points: 3
Priority: Medium
Sprint: Sprint 3

驗收標準 (Acceptance Criteria)

**AC1: 手勢emoji顯示**
Given 玩家和AI角色都有指定的RPS屬性
When 遊戲介面渲染角色資訊
Then 玩家角色應該顯示對應的emoji：
And 石頭屬性顯示：✊
And 布屬性顯示：✋ 
And 剪刀屬性顯示：✌️
And emoji應該顯示在角色上方或旁邊
And emoji大小應該清楚可見（最小32px）

**AC2: 玩家資訊面板**
Given 遊戲正在進行中
When 顯示玩家資訊
Then 應該包含以下資訊：
And 玩家名稱："玩家" (可自訂)
And 當前分數：格式 "玩家: X"
And 當前屬性：文字 + emoji顯示
And AI名稱："AI" + 策略類型
And AI分數：格式 "AI: Y"
And AI屬性：文字 + emoji顯示

**AC3: 色彩區分設計**
Given 需要區分玩家和AI的視覺元素
When 設計介面色彩配置
Then 玩家相關元素應該使用藍色系 (#2196F3)
And AI相關元素應該使用紅色系 (#F44336)
And 中性元素使用灰色系 (#757575)
And 色彩對比度應該符合WCAG AA標準 (>4.5:1)
And 在色盲測試下仍能有效區分

**AC4: 動態資訊更新**
Given 遊戲狀態發生變化
When 屬性變換或分數更新
Then emoji應該即時更新顯示
And 分數變化應該有視覺動效（如數字跳動）
And 屬性變換應該有過渡動畫（淡入淡出）
And 更新不應該造成畫面閃爍或卡頓

**AC5: 響應式顯示**
Given 不同的螢幕尺寸和解析度
When 遊戲在不同裝置上運行
Then 在桌面螢幕（>1024px）：資訊顯示在左右兩側
And 在平板裝置（768-1024px）：資訊顯示在上下兩側
And 在手機裝置（<768px）：資訊以浮動方式顯示
And emoji和文字應該自動縮放保持可讀性

**AC6: 倒數計時器視覺設計**
Given RPS屬性變換倒數進行中
When 顯示倒數計時器
Then 計時器應該顯示在畫面中央上方
And 數字應該大且清楚（最小48px字體）
And 最後3秒應該有警告色彩（橙色→紅色）
And 歸零時應該有明顯的視覺提示

---

#### Story F07-1（BR8）
Epic: 核心遊戲體驗
Feature: 遊戲控制介面
Story: 作為玩家，我希望有完整的遊戲設定面板和控制功能。

Story Points: 5
Priority: Medium
Sprint: Sprint 3

驗收標準 (Acceptance Criteria)

**AC1: 遊戲設定面板設計**
Given 玩家需要調整遊戲參數
When 玩家點擊設定按鈕
Then 應該顯示設定面板包含：
And AI策略選擇（下拉選單）
And RPS變換間隔（3/5/10秒單選）
And 勝利分數設定（1/3/5/7分單選）
And 音效開關（切換按鈕）
And 確認和取消按鈕

**AC2: 設定值驗證與保存**
Given 玩家修改遊戲設定
When 玩家點擊確認按鈕
Then 系統應該驗證所有設定值有效性
And 儲存設定到本地存儲（localStorage）
And 立即應用新設定到當前遊戲
And 顯示"設定已保存"確認訊息
And 關閉設定面板

**AC3: 遊戲暫停功能**
Given 遊戲正在進行中
When 玩家按下空白鍵或點擊暫停按鈕
Then 遊戲應該立即暫停
And 停止所有移動和計時
And 顯示"遊戲已暫停"訊息
And 顯示繼續遊戲按鈕
And 背景應該半透明覆蓋

**AC4: 遊戲重啟功能**
Given 玩家想要重新開始當前遊戲
When 玩家按下R鍵或點擊重啟按鈕
Then 系統應該顯示確認對話框："確定要重新開始嗎？"
And 如果確認，重置所有遊戲狀態：
And 分數歸零
And 角色回到初始位置
And 重新分配屬性
And 重啟計時器

**AC5: 快捷鍵控制**
Given 玩家在遊戲中
When 玩家使用鍵盤快捷鍵
Then 系統應該支援以下快捷鍵：
And 空白鍵：暫停/繼續遊戲
And R鍵：重啟遊戲
And S鍵：開啟設定面板
And ESC鍵：關閉當前對話框
And 方向鍵：角色移動

**AC6: 設定面板UI/UX**
Given 設定面板的使用者體驗
When 玩家操作設定介面
Then 面板應該有清楚的分類標籤
And 每個設定項目都有說明文字
And 滑鼠懸停時顯示更詳細的說明
And 使用直觀的圖示和顏色
And 支援鍵盤Tab導航

**AC7: 遊戲狀態持久化**
Given 玩家關閉或重新整理頁面
When 遊戲重新載入
Then 系統應該記住玩家的設定偏好
And 自動載入上次的設定值
And 但不恢復遊戲進度（重新開始）
And 顯示載入完成的確認訊息

**AC8: 控制功能的可訪問性**
Given 視覺或行動不便的使用者
When 使用遊戲控制功能
Then 所有按鈕都應該支援鍵盤操作
And 有適當的焦點指示器
And 按鈕應該有描述性的aria-label
And 支援螢幕閱讀器
And 按鈕尺寸足夠大（最小44x44px）

---

### Sprint 4: 進階功能

#### Story F08-1（BR9）
Epic: 技術品質體驗
Feature: 進階AI預測
Story: 作為玩家，我希望進階AI能預測我的移動，提供更大挑戰。

Story Points: 8
Priority: Medium
Sprint: Sprint 4

驗收標準 (Acceptance Criteria)

**AC1: 移動歷史記錄系統**
Given 進階AI策略已啟用
When 玩家在遊戲中移動
Then AI應該記錄玩家的移動歷史
And 記錄格式：{時間戳, x坐標, y坐標, 移動方向}
And 保持最近20步的移動資料
And 超過20步時自動清除最舊的記錄
And 每局遊戲重新開始時清除歷史

**AC2: 移動模式分析**
Given AI已收集足夠的移動歷史（≥10步）
When AI分析玩家移動模式
Then AI應該識別以下模式：
And 方向偏好：計算8個方向的使用頻率
And 移動節奏：分析移動間隔和速度變化
And 位置偏好：識別玩家常待的區域
And 迴避模式：分析玩家的迴避行為
And 攻擊模式：分析玩家的追擊行為

**AC3: 位置預測算法**
Given 移動模式分析完成
When AI需要預測玩家下一步位置
Then AI應該使用以下預測邏輯：
And 基於最近3步移動的線性預測
And 考慮玩家的方向偏好加權
And 根據當前屬性關係調整預測
And 考慮遊戲區域邊界限制
And 預測準確度目標達到65%

**AC4: 策略適應性調整**
Given AI已建立預測模型
When AI制定移動策略
Then AI應該根據預測結果調整行為：
And 如果預測玩家會逃避，AI提前堵截
And 如果預測玩家會攻擊，AI準備迎戰或迴避
And 如果屬性劣勢，AI預先移動到安全位置
And 如果屬性優勢，AI主動接近預測位置

**AC5: 預測準確度測量**
Given 進階AI運行一段時間
When 評估預測效果
Then 系統應該追蹤以下指標：
And 位置預測準確率（實際位置在預測範圍內）
And 方向預測準確率（實際移動方向匹配）
And AI勝率相比基礎AI的提升百分比
And 預測計算的平均執行時間

**AC6: 自適應學習機制**
Given AI預測準確度低於目標值
When AI偵測到預測效果不佳
Then AI應該自動調整預測參數：
And 增加歷史資料權重
And 調整不同模式的重要性
And 縮短或延長預測時間窗口
And 更新預測算法的參數

**AC7: 反預測策略**
Given 玩家可能察覺AI的預測行為
When 玩家刻意改變移動模式
Then AI應該能夠識別這種變化：
And 偵測移動模式的突然改變
And 暫時降低預測信心度
And 增加隨機性以避免過度依賴預測
And 重新學習新的移動模式

**AC8: 效能優化要求**
Given 預測算法需要即時運算
When 進階AI執行預測分析
Then 效能應該符合以下要求：
And 每次預測計算時間<10ms
And 記憶體使用增加<20MB
And 不影響60fps的遊戲運行
And CPU使用率增加<3%

---

#### Story F09-1（BR10）
Epic: 技術品質體驗
Feature: 可訪問性支援
Story: 作為視覺不便者，我希望介面有良好色彩對比和鍵盤導航。

Story Points: 3
Priority: Low
Sprint: Sprint 4

驗收標準 (Acceptance Criteria)

**AC1: 色彩對比度標準**
Given 介面需要支援視覺不便使用者
When 檢查所有UI元素的色彩對比
Then 所有文字與背景的對比度應該≥4.5:1 (WCAG AA)
And 重要訊息的對比度應該≥7:1 (WCAG AAA)
And 使用色彩對比度檢查工具驗證
And 在高對比度模式下仍能正常顯示

**AC2: 鍵盤導航支援**
Given 使用者無法使用滑鼠
When 使用鍵盤操作遊戲介面
Then 所有互動元素都應該可用Tab鍵訪問
And 焦點順序應該符合邏輯（由左到右，由上到下）
And 當前焦點應該有清楚的視覺指示
And Enter/Space鍵應該能啟動按鈕和連結
And Esc鍵應該能關閉對話框

**AC3: 螢幕閱讀器支援**
Given 視覺不便使用者使用螢幕閱讀器
When 螢幕閱讀器掃描遊戲介面
Then 所有重要元素都應該有適當的aria-label
And 遊戲狀態變化應該有aria-live通知
And 按鈕和連結應該有描述性的標籤
And 分數和時間更新應該能被讀出
And 遊戲區域應該有地標標籤（landmark）

**AC4: 高對比度模式**
Given 使用者啟用系統高對比度模式
When 遊戲偵測到高對比度設定
Then 應該自動切換到高對比度主題
And 背景使用純黑色或純白色
And 文字使用對比色（白色或黑色）
And 邊框和分隔線應該清楚可見
And emoji可以選擇性替換為文字

**AC5: 字體大小調整**
Given 使用者有視覺障礙需要放大文字
When 使用者調整瀏覽器字體大小
Then 介面應該能適應200%的字體放大
And 文字不應該重疊或被截斷
And 按鈕和輸入框也應該相應放大
And 整體版面應該保持可用性

**AC6: 動畫和閃爍控制**
Given 使用者對動畫敏感或有癲癇風險
When 檢測到prefers-reduced-motion設定
Then 應該減少或關閉非必要動畫
And 避免快速閃爍的視覺效果
And 提供停用動畫的設定選項
And 重要資訊不應該只透過動畫傳達

**AC7: 語音提示（可選）**
Given 遊戲支援語音輔助
When 重要遊戲事件發生
Then 可以提供簡短的語音提示：
And "玩家得分"、"AI得分"、"遊戲結束"
And 音量可以獨立調整
And 可以完全關閉語音功能
And 支援不同語言的語音

**AC8: 可訪問性測試驗證**
Given 實施所有可訪問性功能
When 進行可訪問性測試
Then 應該通過以下測試：
And 使用螢幕閱讀器（NVDA/JAWS）完整遊戲流程
And 僅使用鍵盤完成所有操作
And 在高對比度模式下正常使用
And 使用色盲模擬器驗證可用性
And 通過WAVE或類似工具的自動化檢測

---

## 2. 功能級 Use Case（標註FRD規則ID）

| Use Case ID | 名稱             | 主要演員 | 前置條件         | 主流程                                                         | 驗收標準/DoD           | Story Point | 追溯FRD規則ID |
|-------------|------------------|----------|------------------|----------------------------------------------------------------|------------------------|-------------|---------------|
| FUC01       | 屬性分配與計時   | 玩家/AI  | 遊戲開始/計時到  | 1. 隨機分配屬性<br>2. 啟動倒數計時<br>3. 顯示計時器<br>4. 到期重分配 | 屬性正確、計時準確     | 5           | BR1, BR2, BR7 |
| FUC02       | 角色移動控制     | 玩家/AI  | 遊戲進行中       | 1. 玩家方向鍵輸入<br>2. AI策略計算<br>3. 位置更新<br>4. 邊界檢查 | 移動流暢、邊界正確     | 3           | BR3, BR6      |
| FUC03       | 碰撞與得分       | 系統     | 角色碰撞         | 1. 檢測碰撞<br>2. 判斷屬性相剋<br>3. 更新分數<br>4. 檢查勝利   | 判斷正確、分數正確     | 5           | BR4, BR5      |
| FUC04       | AI策略執行       | AI       | 遊戲進行中       | 1. 分析遊戲狀態<br>2. 選擇策略<br>3. 計算移動<br>4. 執行動作   | 策略正確、行為合理     | 8           | BR9           |
| FUC05       | 牆角脫困         | AI       | AI接近邊界       | 1. 檢測牆角狀態<br>2. 評估8方向<br>3. 選擇脫困路徑<br>4. 執行移動 | 脫困成功、不卡死       | 5           | BR10          |
| FUC06       | 遊戲控制         | 玩家     | 遊戲進行中       | 1. 按下控制鍵<br>2. 更新遊戲狀態<br>3. 暫停/重啟功能<br>4. 狀態保存 | 控制正確、狀態一致     | 5           | BR8           |
| FUC07       | 設定管理         | 玩家     | 遊戲設定頁面     | 1. 選擇AI策略<br>2. 設定時間間隔<br>3. 設定勝利分數<br>4. 應用設定 | 設定保存、生效正常     | 5           | BR7, BR8      |
| FUC08       | 移動預測         | AI       | 進階AI模式       | 1. 收集移動歷史<br>2. 分析移動模式<br>3. 預測未來位置<br>4. 調整策略 | 預測準確、策略優化     | 8           | BR9           |
| FUC09       | 視覺反饋         | 系統     | 遊戲進行中       | 1. 顯示手勢emoji<br>2. 更新玩家資訊<br>3. 狀態提示<br>4. 色彩區分 | 視覺清晰、資訊準確     | 3           | BR7           |
| FUC10       | 可訪問性         | 系統     | 任何時候         | 1. 檢查色彩對比<br>2. 提供鍵盤導航<br>3. 語義化標籤<br>4. 輔助功能 | 可訪問性標準達標       | 3           | BR10          |

---

## 3. 開發里程碑

### Sprint 1 - 核心機制（5天）
- 基本遊戲邏輯實現
- 玩家移動控制
- 碰撞檢測系統
- 分數計算

### Sprint 2 - AI系統（8天）
- 4種AI策略實現
- 牆角脫困機制
- AI行為調優
- 策略切換功能

### Sprint 3 - 用戶介面（5天）
- 遊戲設定面板
- 玩家資訊顯示
- 視覺反饋系統
- 控制功能

### Sprint 4 - 進階功能（8天）
- AI移動預測
- 可訪問性改善
- 性能優化
- 測試完善

---

## 4. 驗收標準

### 功能驗收
- 所有Story的DoD必須達成
- 所有Use Case的驗收標準必須通過
- 無阻塞性Bug

### 技術驗收
- 60fps穩定運行
- 記憶體使用<50MB
- CPU使用<5%
- TypeScript編譯無錯誤

### 用戶驗收
- 90%用戶能在10秒內理解遊戲
- 80%用戶認為AI行為合理
- 70%用戶會調整遊戲設定

---

## 5. 風險評估

### 技術風險
- **AI算法複雜度**：分階段實現，先簡單後複雜
- **性能優化**：持續監控，及時調整
- **瀏覽器兼容**：使用標準API，測試主流瀏覽器

### 產品風險
- **遊戲平衡性**：提供多種難度選項
- **用戶體驗**：持續測試，收集反饋
- **可擴展性**：模組化設計，預留擴展接口

---

## 6. 測試策略

### 單元測試
- 遊戲邏輯函數測試
- AI策略行為測試
- 工具函數測試

### 整合測試
- 完整遊戲流程測試
- AI與遊戲邏輯整合測試
- UI組件整合測試

### 用戶測試
- 可用性測試
- 可訪問性測試
- 性能測試

---

## 7. 追溯矩陣
- 來源FRD規則ID：BR1~BR10
- 涵蓋所有業務規則和功能需求
- 支援開發實現和測試驗證

---

## 8. 驗收標準撰寫檢核表

### ✅ 場景涵蓋度檢核
- [x] 正常流程 (Happy Path) - 所有核心功能的標準使用情境
- [x] 異常流程 (Error Cases) - 錯誤處理和例外情況
- [x] 邊界條件 (Boundary Conditions) - 極值和臨界情況
- [x] 併發情況 (Concurrent Access) - 多重操作和時序問題
- [x] 權限控制 (Authorization) - 不同使用者權限驗證
- [x] 效能要求 (Performance) - 響應時間和資源使用
- [x] 安全性要求 (Security) - 資料保護和輸入驗證
- [x] 可用性要求 (Usability) - 使用者體驗和可訪問性

### ✅ SMART 原則檢核
- [x] Specific: 每個條件都具體明確，包含明確的輸入輸出
- [x] Measurable: 結果可量化驗證，包含具體的數值要求
- [x] Achievable: 技術上可實現，基於現有技術能力
- [x] Relevant: 與業務目標相關，支援遊戲核心體驗
- [x] Time-bound: 有明確的時間要求和效能指標

### ✅ 可測試性檢核
- [x] 每個 AC 都可自動化測試
- [x] 測試資料需求已明確 (座標、時間、分數等)
- [x] 驗證方法清楚可執行 (Given-When-Then格式)
- [x] 通過/失敗標準明確定義

### ✅ 完整性檢核
- [x] 涵蓋所有Sprint的核心功能
- [x] 包含正常和異常流程
- [x] 考慮不同使用者類型和需求
- [x] 包含效能和可訪問性要求
- [x] 提供明確的測試驗證標準

### 🎯 重點驗收領域

#### 核心遊戲機制 (Sprint 1)
- **屬性系統**: 隨機分配、間隔設定、計時器功能
- **移動控制**: 方向鍵、邊界限制、效能要求
- **碰撞系統**: 檢測機制、相剋判斷、計分邏輯

#### AI智慧系統 (Sprint 2)
- **策略多樣性**: 4種AI行為模式的差異化
- **脫困機制**: 牆角偵測、路徑評估、緊急移動

#### 使用者介面 (Sprint 3)
- **視覺系統**: emoji顯示、資訊面板、色彩對比
- **控制介面**: 設定面板、快捷鍵、狀態持久化

#### 進階功能 (Sprint 4)
- **AI預測**: 移動分析、位置預測、適應性調整
- **可訪問性**: 對比度、鍵盤導航、螢幕閱讀器支援

---

## 9. 邊界條件測試清單

### 數值邊界
- **座標極值**: (0,0), (800,0), (0,600), (800,600)
- **分數極值**: 0分到設定上限(1/3/5/7分)
- **時間極值**: 3秒、5秒、10秒間隔的準確性
- **AI記錄**: 移動歷史20步上限測試

### 併發狀況
- **同時事件**: 屬性變換時發生碰撞
- **快速操作**: 連續快速按鍵輸入
- **邊界操作**: 邊界附近的移動和碰撞
- **設定變更**: 遊戲進行中修改設定

### 異常情況
- **無效輸入**: 錯誤的設定值或操作
- **網路中斷**: 本地遊戲的離線可用性
- **記憶體不足**: 長時間遊戲的記憶體管理
- **CPU負載**: 高負載情況下的遊戲表現

---

## 10. 簽署確認
| 角色         | 姓名/簽名 | 日期       | 版本    |
|--------------|-----------|------------|---------|
| 產品經理     | AI        | 2025-07-25 | v3.0-AC |
| 開發負責人   | AI        | 2025-07-25 | v3.0-AC |
| UI/UX設計師  | AI        | 2025-07-25 | v3.0-AC |
| 測試負責人   | AI        | 2025-07-25 | v3.0-AC | 